

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <script src="/Client/AjaxCalls.js"></script>

</head>
<body>
    <form id="form1" runat="server">
    </form>
    <div>
        <h2> Get Token: </h2>
        <div>
            <input type="text" id="username" value="user" />
            <input type="password" id="password" value="user" />
            <button onclick="GetToken()">Submit</button>
        </div>


        <div>
            <button onclick="LogOut()"> Logout</button>
        </div>
        <div>
            <button onclick="getPersonalInfo()"> Get Personal Info</button>
        </div>


        <div>
            <span id="results_ph">

            </span>

        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script>
        function GetToken() {
            console.log(username.value, password.value);
            getTokenAjax(username.value, password.value);
        }

        function LogOut() {
			sessionStorage.removeItem("username");
			sessionStorage.removeItem("password");
			sessionStorage.removeItem("access_token");
        }

        function getTokenAjax(username, password) {
            let data = {
                username: username, 
                password: password,
                grant_type: "password"
            }
            $.ajax({
                url: "https://localhost:44326/token",
                type: "POST",
                data: { username: username, password: password, grant_type: "password" },
                success: function (res) {
					sessionStorage.setItem("username", username);
					sessionStorage.setItem("password", password);
					sessionStorage.setItem("access_token", res.access_token);
                    successCB(res);

                },
                error: errorCB,
            })
        }


        // Retrieve

        function getPersonalInfo() {            
			let username = sessionStorage.getItem("username");
			let password = sessionStorage.getItem("password");

			AuthenticateFunction(username, password, successCB, errorCB )
        }


        function successCB(res) {
            console.log(res)
            alert("success" + res)
             res = "success:\n" + res;
            $('#results_ph').html(res)
        }
		function errorCB(err) {
            let res = "Error:\n" + err.responseText
            $('#results_ph').html(res) 
        }



    </script>

</body>
</html>
